<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Villages Laos Data Management</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto sans lao', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --white: #ffffff;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            color: var(--white);
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--white);
        }

        .btn-success {
            background-color: var(--success);
            color: var(--white);
        }

        .btn-danger {
            background-color: var(--danger);
            color: var(--white);
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--white);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--white);
            color: var(--white);
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 140px);
        }

        .section {
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 1.5rem;
        }

        .select-box {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background-color: var(--white);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 1rem;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: var(--white);
            border-radius: 4px;
            cursor: pointer;
        }

        .page-btn.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            margin: 0 10px;
        }

        .modal {
            display: none;
            position:absolute;
            top: 3px;
            left: 2px;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--white);
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            margin: auto;
            padding: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 0.7rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.2rem;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .id-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .auto-id-btn {
            padding: 5px 10px;
            background-color: var(--info);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1.5rem;
        }

        .login-container {
            max-width: 400px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .login-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary);
        }

        .alert {
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .hidden {
            display: none;
        }

        footer {
            background: var(--dark);
            color: var(--white);
            padding: 1.5rem 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .search-box {
                flex-direction: column;
            }

            .filter-section {
                grid-template-columns: 1fr;
            }

            th, td {
                padding: 8px 10px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .id-input-group {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>ບ້ານ-ເມືອງ-ແຂວງ ລາວ</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-page="user-search">ຄົ້ນຫາບ້ານ</a></li>
                        <li><a href="#" class="nav-link" data-page="province-management">ແຂວງ</a></li>
                        <li><a href="#" class="nav-link" data-page="district-management">ເມືອງ</a></li>
                        <li><a href="#" class="nav-link" data-page="village-management">ບ້ານ</a></li>
                    </ul>
                </nav>
                <div class="auth-buttons">
                    <button id="login-btn" class="btn btn-outline"><i class="fas fa-sign-in-alt"></i> Admin Login</button>
                    <button id="logout-btn" class="btn btn-outline hidden"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- User Search Section -->
            <section id="user-search" class="page-section">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">ຄົ້ນຫາບ້ານ</h2>
                    </div>
                    
                    <div class="filter-section">
                        <select id="province-filter" class="select-box">
                            <option value="">>>ເລືອກແຂວງ>></option>
                        </select>
                        <select id="district-filter" class="select-box">
                            <option value="">>>ເລືອກເມືອງ>></option>
                        </select>
                        <div class="search-box">
                            <input type="text" id="village-search" class="search-input" placeholder="ຄົ້ນຫາບ້ານ...">
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="village-table">
                            <thead>
                                <tr>
                                    <th>ຊື່ບ້ານ</th>
                                    <th>ຊື່ບ້ານ(EN)</th>
                                    <th>ເມືອງ</th>
                                    <th>ແຂວງ</th>
                                </tr>
                            </thead>
                            <tbody id="village-table-body">
                                <!-- Village data will be populated here -->
                                <tr>
                                    <td colspan="4" style="text-align: center;">ເລີ່ມພິມຄົ້ນຫາບ້ານໄດ້ເລີຍ</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button class="page-btn" id="prev-page"><i class="fas fa-chevron-left"></i></button>
                        <span class="page-info">ໜ້າທີ <span id="current-page">1</span> ຈາກທັງໝົດ<span id="total-pages">1</span></span>
                        <button class="page-btn" id="next-page"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </section>

            <!-- Province Management Section (Admin Only) -->
            <section id="province-management" class="page-section hidden">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">ແຂວງ</h2>
                        <button id="add-province-btn" class="btn btn-primary"><i class="fas fa-plus"></i> ເພີ່ມແຂວງ</button>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" id="province-search" class="search-input" placeholder="ຄົ້ນຫາແຂວງ...">
                    </div>
                    
                    <div class="table-container">
                        <table id="province-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ຊື່ແຂວງ</th>
                                    <th>ຊື່ແຂວງ(EN)</th>
                                    <th>ປຸ່ມຄຳສັ່ງ</th>
                                </tr>
                            </thead>
                            <tbody id="province-table-body">
                                <!-- Province data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button class="page-btn" id="prev-page-province"><i class="fas fa-chevron-left"></i></button>
                        <span class="page-info">ໜ້າທີ <span id="current-page-province">1</span> ຈາກທັງໝົດ <span id="total-pages-province">1</span></span>
                        <button class="page-btn" id="next-page-province"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </section>

            <!-- District Management Section (Admin Only) -->
            <section id="district-management" class="page-section hidden">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">ເມືອງ</h2>
                        <button id="add-district-btn" class="btn btn-primary"><i class="fas fa-plus"></i> ເພີ່ມເມືອງ</button>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" id="district-search" class="search-input" placeholder="ຄົ້ນຫາເມືອງ...">
                    </div>
                    
                    <div class="table-container">
                        <table id="district-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ຊື່ເມືອງ</th>
                                    <th>ຊື່ເມືອງ(EN)</th>
                                    <th>ແຂວງ</th>
                                    <th>ປຸ່ມຄຳສັ່ງ</th>
                                </tr>
                            </thead>
                            <tbody id="district-table-body">
                                <!-- District data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button class="page-btn" id="prev-page-district"><i class="fas fa-chevron-left"></i></button>
                        <span class="page-info">ໜ້າທີ <span id="current-page-district">1</span> ຈາກທັງໝົດ <span id="total-pages-district">1</span></span>
                        <button class="page-btn" id="next-page-district"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </section>

            <!-- Village Management Section (Admin Only) -->
            <section id="village-management" class="page-section hidden">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">ບ້ານ</h2>
                        <button id="add-village-btn" class="btn btn-primary"><i class="fas fa-plus"></i> ເພີ່ມບ້ານ</button>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" id="village-admin-search" class="search-input" placeholder="ຄົ້ນຫາບ້ານ...">
                    </div>
                    
                    <div class="table-container">
                        <table id="village-admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ຊື່ບ້ານ</th>
                                    <th>ຊື່ບ້ານ(EN)</th>
                                    <th>ເມືອງ</th>
                                    <th>ແຂວງ</th>
                                    <th>ປຸ່ມຄຳສັ່ງ</th>
                                </tr>
                            </thead>
                            <tbody id="village-admin-table-body">
                                <!-- Village data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button class="page-btn" id="prev-page-village"><i class="fas fa-chevron-left"></i></button>
                        <span class="page-info">ໜ້າທີ <span id="current-page-village">1</span> ຈາກທັງໝົດ <span id="total-pages-village">1</span></span>
                        <button class="page-btn" id="next-page-village"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </section>

            <!-- Login Form -->
            <section id="login-section" class="page-section hidden">
                <div class="login-container">
                    <h2 class="login-title">Admin Login</h2>
                    <div id="login-alert" class="alert alert-error hidden">Invalid credentials</div>
                    <form id="login-form">
                        <div class="form-group">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" id="email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" id="password" class="form-input" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Login</button>
                        </div>
                    </form>
                </div>
            </section>
        </div>
    </main>

    <!-- Add/Edit Province Modal -->
    <div id="province-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="province-modal-title">ເພີ່ມບ້ານ</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="province-form">
                <div class="form-group">
                    <label for="province-id" class="form-label">ID ແຂວງ</label>
                    <div class="id-input-group">
                        <input type="number" id="province-id" class="form-input" required min="1" max="99">
                        <button type="button" id="auto-province-id" class="auto-id-btn">ID ອັດຕະໂນມັດ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="province-name" class="form-label">ຊື່ແຂວງ</label>
                    <input type="text" id="province-name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="province-name-en" class="form-label">ຊື່ແຂວງ(English)</label>
                    <input type="text" id="province-name-en" class="form-input">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary close-modal">ຍົກເລີກ</button>
                    <button type="submit" class="btn btn-primary">ບັນທຶກ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit District Modal -->
    <div id="district-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="district-modal-title">ເພີ່ມເມືອງ</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="district-form">
                <div class="form-group">
                    <label for="district-id" class="form-label">ID ເມືອງ</label>
                    <div class="id-input-group">
                        <input type="number" id="district-id" class="form-input" required min="1" max="999">
                        <button type="button" id="auto-district-id" class="auto-id-btn">ID ອັດຕະໂນມັດ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="district-name" class="form-label">ຊື່ເມືອງ</label>
                    <input type="text" id="district-name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="district-name-en" class="form-label">ຊື່ເມືອງ(English)</label>
                    <input type="text" id="district-name-en" class="form-input">
                </div>
                <div class="form-group">
                    <label for="district-province" class="form-label">ແຂວງ</label>
                    <select id="district-province" class="form-input" required>
                        <option value="">ເລືອກແຂວງ</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary close-modal">ຍົກເລີກ</button>
                    <button type="submit" class="btn btn-primary">ບັນທຶກ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Village Modal -->
    <div id="village-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="village-modal-title">ເພີ່ມບ້ານ</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="village-form">
                <div class="form-group">
                    <label for="village-id" class="form-label">ID ບ້ານ</label>
                    <div class="id-input-group">
                        <input type="number" id="village-id" class="form-input" required min="1">
                        <button type="button" id="auto-village-id" class="auto-id-btn">ID ອັດຕະໂນມັດ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="village-name" class="form-label">ຊື່ບ້ານ</label>
                    <input type="text" id="village-name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="village-name-en" class="form-label">ຊື່ບ້ານ(English)</label>
                    <input type="text" id="village-name-en" class="form-input">
                </div>
                <div class="form-group">
                    <label for="village-province" class="form-label">ແຂວງ</label>
                    <select id="village-province" class="form-input" required>
                        <option value="">ເລືອກແຂວງ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="village-district" class="form-label">ເມືອງ</label>
                    <select id="village-district" class="form-input" required>
                        <option value="">ເລືອກເມືອງ</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary close-modal">ຍົກເລີກ</button>
                    <button type="submit" class="btn btn-primary">ບັນທຶກ</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 Villages Laos Data Management System. Power by Phoud.</p>
        </div>
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDEN8J1QU1-T8o-X0QF_NdfKqpPSmFvAxY",
            authDomain: "village-laos.firebaseapp.com",
            projectId: "village-laos",
            storageBucket: "village-laos.firebasestorage.app",
            messagingSenderId: "522422295381",
            appId: "1:522422295381:web:cf160b9aad2a18f77d2ddc"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Global variables
        let currentUser = null;
        let currentPage = 'user-search';
        let provinces = [];
        let districts = [];
        let villages = [];
        let searchTimeout = null;

        // DOM elements
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const navLinks = document.querySelectorAll('.nav-link');
        const pageSections = document.querySelectorAll('.page-section');
        const loginSection = document.getElementById('login-section');
        const loginForm = document.getElementById('login-form');
        const loginAlert = document.getElementById('login-alert');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
            loadInitialData();
        });

        function initApp() {
            // Check if user is logged in
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    loginBtn.classList.add('hidden');
                    logoutBtn.classList.remove('hidden');
                    showAdminSections();
                } else {
                    currentUser = null;
                    loginBtn.classList.remove('hidden');
                    logoutBtn.classList.add('hidden');
                    hideAdminSections();
                }
            });
        }

        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });

            // Authentication
            loginBtn.addEventListener('click', function() {
                showPage('login-section');
            });

            logoutBtn.addEventListener('click', function() {
                auth.signOut();
                showPage('user-search');
            });

            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        showPage('province-management');
                        loginAlert.classList.add('hidden');
                    })
                    .catch(error => {
                        loginAlert.textContent = error.message;
                        loginAlert.classList.remove('hidden');
                    });
            });

            // Modal controls
            document.querySelectorAll('.close-btn, .close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                });
            });

            // Add buttons
            document.getElementById('add-province-btn').addEventListener('click', function() {
                showProvinceModal();
            });

            document.getElementById('add-district-btn').addEventListener('click', function() {
                showDistrictModal();
            });

            document.getElementById('add-village-btn').addEventListener('click', function() {
                showVillageModal();
            });

            // Auto ID buttons
            document.getElementById('auto-province-id').addEventListener('click', function() {
                generateAutoProvinceId();
            });

            document.getElementById('auto-district-id').addEventListener('click', function() {
                generateAutoDistrictId();
            });

            document.getElementById('auto-village-id').addEventListener('click', function() {
                generateAutoVillageId();
            });

            // Form submissions
            document.getElementById('province-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProvince();
            });

            document.getElementById('district-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveDistrict();
            });

            document.getElementById('village-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveVillage();
            });

            // Real-time search functionality
            document.getElementById('village-search').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterVillages();
                }, 300);
            });

            document.getElementById('province-search').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterProvinces();
                }, 300);
            });

            document.getElementById('district-search').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterDistricts();
                }, 300);
            });

            document.getElementById('village-admin-search').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterVillagesAdmin();
                }, 300);
            });

            // Province filter change
            document.getElementById('province-filter').addEventListener('change', function() {
                updateDistrictFilter();
                filterVillages();
            });

            document.getElementById('district-filter').addEventListener('change', function() {
                filterVillages();
            });

            // Village form province change
            document.getElementById('village-province').addEventListener('change', function() {
                updateVillageDistrictFilter(this.value);
            });

            // Pagination
            document.getElementById('prev-page').addEventListener('click', function() {
                navigatePage('prev', 'village');
            });

            document.getElementById('next-page').addEventListener('click', function() {
                navigatePage('next', 'village');
            });

            document.getElementById('prev-page-province').addEventListener('click', function() {
                navigatePage('prev', 'province');
            });

            document.getElementById('next-page-province').addEventListener('click', function() {
                navigatePage('next', 'province');
            });

            document.getElementById('prev-page-district').addEventListener('click', function() {
                navigatePage('prev', 'district');
            });

            document.getElementById('next-page-district').addEventListener('click', function() {
                navigatePage('next', 'district');
            });

            document.getElementById('prev-page-village').addEventListener('click', function() {
                navigatePage('prev', 'village-admin');
            });

            document.getElementById('next-page-village').addEventListener('click', function() {
                navigatePage('next', 'village-admin');
            });
        }

        function showPage(page) {
            // Hide all pages
            pageSections.forEach(section => {
                section.classList.add('hidden');
            });

            // Show the selected page
            document.getElementById(page).classList.remove('hidden');

            // Update navigation
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                }
            });

            currentPage = page;

            // Load data for the current page
            switch(page) {
                case 'user-search':
                    displayVillages();
                    break;
                case 'province-management':
                    displayProvinces();
                    break;
                case 'district-management':
                    displayDistricts();
                    break;
                case 'village-management':
                    displayVillagesAdmin();
                    break;
            }
        }

        function showAdminSections() {
            // Enable admin navigation
            navLinks.forEach(link => {
                if (link.getAttribute('data-page') !== 'user-search') {
                    link.style.display = 'block';
                }
            });
        }

        function hideAdminSections() {
            // Disable admin navigation
            navLinks.forEach(link => {
                if (link.getAttribute('data-page') !== 'user-search') {
                    link.style.display = 'none';
                }
            });

            // If on an admin page, redirect to user search
            if (currentPage !== 'user-search' && currentPage !== 'login-section') {
                showPage('user-search');
            }
        }

        function loadInitialData() {
            // Load provinces, districts, and villages from Firebase
            loadProvinces();
            loadDistricts();
            loadVillages();
        }

        function loadProvinces() {
            db.collection('provinces').orderBy('pr_id').get()
                .then(snapshot => {
                    provinces = [];
                    snapshot.forEach(doc => {
                        provinces.push({ id: doc.id, ...doc.data() });
                    });
                    populateProvinceFilters();
                    if (currentPage === 'province-management') {
                        displayProvinces();
                    }
                })
                .catch(error => {
                    console.error('ຂໍ້ຜິດໃນການໂຫຼດຂໍ້ມູນແຂວງ:', error);
                });
        }

        function loadDistricts() {
            db.collection('districts').orderBy('di_id').get()
                .then(snapshot => {
                    districts = [];
                    snapshot.forEach(doc => {
                        districts.push({ id: doc.id, ...doc.data() });
                    });
                    populateDistrictFilters();
                    if (currentPage === 'district-management') {
                        displayDistricts();
                    }
                })
                .catch(error => {
                    console.error('ຂໍ້ຜິດພາດໃນການໂຫຼດຂໍ້ມູນເມືອງ:', error);
                });
        }

        function loadVillages() {
            db.collection('villages').orderBy('vill_id').get()
                .then(snapshot => {
                    villages = [];
                    snapshot.forEach(doc => {
                        villages.push({ id: doc.id, ...doc.data() });
                    });
                    if (currentPage === 'village-management' || currentPage === 'user-search') {
                        if (currentPage === 'village-management') {
                            displayVillagesAdmin();
                        } else {
                            displayVillages();
                        }
                    }
                })
                .catch(error => {
                    console.error('ຂໍ້ຜິດພາດໃນການໂຫຼດຂໍ້ມູນບ້ານ:', error);
                });
        }

        function populateProvinceFilters() {
            const provinceFilter = document.getElementById('province-filter');
            const districtProvince = document.getElementById('district-province');
            const villageProvince = document.getElementById('village-province');
            
            // Clear existing options (except the first one)
            while (provinceFilter.children.length > 1) {
                provinceFilter.removeChild(provinceFilter.lastChild);
            }
            while (districtProvince.children.length > 1) {
                districtProvince.removeChild(districtProvince.lastChild);
            }
            while (villageProvince.children.length > 1) {
                villageProvince.removeChild(villageProvince.lastChild);
            }
            
            // Add provinces to filters
            provinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province.pr_id;
                option.textContent = province.pr_name;
                
                provinceFilter.appendChild(option.cloneNode(true));
                districtProvince.appendChild(option.cloneNode(true));
                villageProvince.appendChild(option);
            });
        }

        function populateDistrictFilters() {
            const districtFilter = document.getElementById('district-filter');
            const villageDistrict = document.getElementById('village-district');
            
            // Clear existing options (except the first one)
            while (districtFilter.children.length > 1) {
                districtFilter.removeChild(districtFilter.lastChild);
            }
            while (villageDistrict.children.length > 1) {
                villageDistrict.removeChild(villageDistrict.lastChild);
            }
            
            // Add districts to filters
            districts.forEach(district => {
                const option = document.createElement('option');
                option.value = district.di_id;
                option.textContent = district.di_name;
                
                districtFilter.appendChild(option.cloneNode(true));
                villageDistrict.appendChild(option);
            });
        }

        function updateDistrictFilter() {
            const provinceId = document.getElementById('province-filter').value;
            const districtFilter = document.getElementById('district-filter');
            
            // Clear existing options (except the first one)
            while (districtFilter.children.length > 1) {
                districtFilter.removeChild(districtFilter.lastChild);
            }
            
            // Add districts for the selected province
            if (provinceId) {
                districts
                    .filter(district => district.pr_id == provinceId)
                    .forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.di_id;
                        option.textContent = district.di_name;
                        districtFilter.appendChild(option);
                    });
            }
        }

        function updateVillageDistrictFilter(provinceId) {
            const villageDistrict = document.getElementById('village-district');
            
            // Clear existing options (except the first one)
            while (villageDistrict.children.length > 1) {
                villageDistrict.removeChild(villageDistrict.lastChild);
            }
            
            // Add districts for the selected province
            districts
                .filter(district => district.pr_id == provinceId)
                .forEach(district => {
                    const option = document.createElement('option');
                    option.value = district.di_id;
                    option.textContent = district.di_name;
                    villageDistrict.appendChild(option);
                });
        }

        function filterVillages() {
            const provinceId = document.getElementById('province-filter').value;
            const districtId = document.getElementById('district-filter').value;
            const searchTerm = document.getElementById('village-search').value.toLowerCase();
            
            let filteredVillages = villages;
            
            // Filter by province
            if (provinceId) {
                filteredVillages = filteredVillages.filter(village => {
                    const district = districts.find(d => d.di_id == village.di_id);
                    return district && district.pr_id == provinceId;
                });
            }
            
            // Filter by district
            if (districtId) {
                filteredVillages = filteredVillages.filter(village => village.di_id == districtId);
            }
            
            // Filter by search term
            if (searchTerm) {
                filteredVillages = filteredVillages.filter(village => 
                    village.vill_name.toLowerCase().includes(searchTerm) || 
                    (village.vill_name_en && village.vill_name_en.toLowerCase().includes(searchTerm))
                );
            }
            
            displayVillages(filteredVillages);
        }

        function filterProvinces() {
            const searchTerm = document.getElementById('province-search').value.toLowerCase();
            
            let filteredProvinces = provinces;
            
            if (searchTerm) {
                filteredProvinces = filteredProvinces.filter(province => 
                    province.pr_name.toLowerCase().includes(searchTerm) || 
                    (province.pr_name_en && province.pr_name_en.toLowerCase().includes(searchTerm))
                );
            }
            
            displayProvinces(filteredProvinces);
        }

        function filterDistricts() {
            const searchTerm = document.getElementById('district-search').value.toLowerCase();
            
            let filteredDistricts = districts;
            
            if (searchTerm) {
                filteredDistricts = filteredDistricts.filter(district => 
                    district.di_name.toLowerCase().includes(searchTerm) || 
                    (district.di_name_en && district.di_name_en.toLowerCase().includes(searchTerm))
                );
            }
            
            displayDistricts(filteredDistricts);
        }

        function filterVillagesAdmin() {
            const searchTerm = document.getElementById('village-admin-search').value.toLowerCase();
            
            let filteredVillages = villages;
            
            if (searchTerm) {
                filteredVillages = filteredVillages.filter(village => 
                    village.vill_name.toLowerCase().includes(searchTerm) || 
                    (village.vill_name_en && village.vill_name_en.toLowerCase().includes(searchTerm))
                );
            }
            
            displayVillagesAdmin(filteredVillages);
        }

        function displayVillages(villageList = villages) {
            const tableBody = document.getElementById('village-table-body');
            tableBody.innerHTML = '';
            
            if (villageList.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="4" style="text-align: center;">ບໍ່ພົບຂໍ້ມູນບ້ານ</td>`;
                tableBody.appendChild(row);
                return;
            }
            
            // For user search, show 10 records per page
            const pageSize = 10;
            const currentPageNum = parseInt(document.getElementById('current-page').textContent) || 1;
            const startIndex = (currentPageNum - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const paginatedVillages = villageList.slice(startIndex, endIndex);
            const totalPages = Math.ceil(villageList.length / pageSize);
            
            document.getElementById('total-pages').textContent = totalPages;
            
            paginatedVillages.forEach(village => {
                const district = districts.find(d => d.di_id == village.di_id);
                const province = district ? provinces.find(p => p.pr_id == district.pr_id) : null;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${village.vill_name}</td>
                    <td>${village.vill_name_en || '-'}</td>
                    <td>${district ? district.di_name : 'Unknown'}</td>
                    <td>${province ? province.pr_name : 'Unknown'}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Update pagination buttons
            document.getElementById('prev-page').disabled = currentPageNum <= 1;
            document.getElementById('next-page').disabled = currentPageNum >= totalPages;
        }

        function displayProvinces(provinceList = provinces) {
            const tableBody = document.getElementById('province-table-body');
            tableBody.innerHTML = '';
            
            if (provinceList.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="4" style="text-align: center;">ບໍ່ພົບຂໍ້ມູນແຂວງ</td>`;
                tableBody.appendChild(row);
                return;
            }
            
            const pageSize = 10;
            const currentPageNum = parseInt(document.getElementById('current-page-province').textContent) || 1;
            const startIndex = (currentPageNum - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const paginatedProvinces = provinceList.slice(startIndex, endIndex);
            const totalPages = Math.ceil(provinceList.length / pageSize);
            
            document.getElementById('total-pages-province').textContent = totalPages;
            
            paginatedProvinces.forEach(province => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${province.pr_id}</td>
                    <td>${province.pr_name}</td>
                    <td>${province.pr_name_en || '-'}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-warning edit-province" data-id="${province.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger delete-province" data-id="${province.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Update pagination buttons
            document.getElementById('prev-page-province').disabled = currentPageNum <= 1;
            document.getElementById('next-page-province').disabled = currentPageNum >= totalPages;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.edit-province').forEach(btn => {
                btn.addEventListener('click', function() {
                    const provinceId = this.getAttribute('data-id');
                    editProvince(provinceId);
                });
            });
            
            document.querySelectorAll('.delete-province').forEach(btn => {
                btn.addEventListener('click', function() {
                    const provinceId = this.getAttribute('data-id');
                    deleteProvince(provinceId);
                });
            });
        }

        function displayDistricts(districtList = districts) {
            const tableBody = document.getElementById('district-table-body');
            tableBody.innerHTML = '';
            
            if (districtList.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center;">ບໍ່ພົບຂໍ້ມູນເມືອງ</td>`;
                tableBody.appendChild(row);
                return;
            }
            
            const pageSize = 10;
            const currentPageNum = parseInt(document.getElementById('current-page-district').textContent) || 1;
            const startIndex = (currentPageNum - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const paginatedDistricts = districtList.slice(startIndex, endIndex);
            const totalPages = Math.ceil(districtList.length / pageSize);
            
            document.getElementById('total-pages-district').textContent = totalPages;
            
            paginatedDistricts.forEach(district => {
                const province = provinces.find(p => p.pr_id == district.pr_id);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${district.di_id}</td>
                    <td>${district.di_name}</td>
                    <td>${district.di_name_en || '-'}</td>
                    <td>${province ? province.pr_name : 'Unknown'}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-warning edit-district" data-id="${district.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger delete-district" data-id="${district.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Update pagination buttons
            document.getElementById('prev-page-district').disabled = currentPageNum <= 1;
            document.getElementById('next-page-district').disabled = currentPageNum >= totalPages;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.edit-district').forEach(btn => {
                btn.addEventListener('click', function() {
                    const districtId = this.getAttribute('data-id');
                    editDistrict(districtId);
                });
            });
            
            document.querySelectorAll('.delete-district').forEach(btn => {
                btn.addEventListener('click', function() {
                    const districtId = this.getAttribute('data-id');
                    deleteDistrict(districtId);
                });
            });
        }

        function displayVillagesAdmin(villageList = villages) {
            const tableBody = document.getElementById('village-admin-table-body');
            tableBody.innerHTML = '';
            
            if (villageList.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center;">ບໍ່ພົບຂໍ້ມູນບ້ານ</td>`;
                tableBody.appendChild(row);
                return;
            }
            
            const pageSize = 10;
            const currentPageNum = parseInt(document.getElementById('current-page-village').textContent) || 1;
            const startIndex = (currentPageNum - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const paginatedVillages = villageList.slice(startIndex, endIndex);
            const totalPages = Math.ceil(villageList.length / pageSize);
            
            document.getElementById('total-pages-village').textContent = totalPages;
            
            paginatedVillages.forEach(village => {
                const district = districts.find(d => d.di_id == village.di_id);
                const province = district ? provinces.find(p => p.pr_id == district.pr_id) : null;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${village.vill_id}</td>
                    <td>${village.vill_name}</td>
                    <td>${village.vill_name_en || '-'}</td>
                    <td>${district ? district.di_name : 'Unknown'}</td>
                    <td>${province ? province.pr_name : 'Unknown'}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-warning edit-village" data-id="${village.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn btn-danger delete-village" data-id="${village.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Update pagination buttons
            document.getElementById('prev-page-village').disabled = currentPageNum <= 1;
            document.getElementById('next-page-village').disabled = currentPageNum >= totalPages;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.edit-village').forEach(btn => {
                btn.addEventListener('click', function() {
                    const villageId = this.getAttribute('data-id');
                    editVillage(villageId);
                });
            });
            
            document.querySelectorAll('.delete-village').forEach(btn => {
                btn.addEventListener('click', function() {
                    const villageId = this.getAttribute('data-id');
                    deleteVillage(villageId);
                });
            });
        }

        function showProvinceModal(province = null) {
            const modal = document.getElementById('province-modal');
            const title = document.getElementById('province-modal-title');
            const form = document.getElementById('province-form');
            
            if (province) {
                title.textContent = 'ແກ້ໄຂແຂວງ';
                document.getElementById('province-id').value = province.pr_id;
                document.getElementById('province-name').value = province.pr_name;
                document.getElementById('province-name-en').value = province.pr_name_en || '';
                form.setAttribute('data-id', province.id);
            } else {
                title.textContent = 'ເພີ່ມແຂວງ';
                form.reset();
                form.removeAttribute('data-id');
                // Generate auto ID for new province
                generateAutoProvinceId();
            }
            
            modal.style.display = 'flex';
        }

        function showDistrictModal(district = null) {
            const modal = document.getElementById('district-modal');
            const title = document.getElementById('district-modal-title');
            const form = document.getElementById('district-form');
            
            if (district) {
                title.textContent = 'ແກ້ໄຂເມືອງ';
                document.getElementById('district-id').value = district.di_id;
                document.getElementById('district-name').value = district.di_name;
                document.getElementById('district-name-en').value = district.di_name_en || '';
                document.getElementById('district-province').value = district.pr_id;
                form.setAttribute('data-id', district.id);
            } else {
                title.textContent = 'ເພີ່ມເມືອງ';
                form.reset();
                form.removeAttribute('data-id');
                // Generate auto ID for new district
                generateAutoDistrictId();
            }
            
            modal.style.display = 'flex';
        }

        function showVillageModal(village = null) {
            const modal = document.getElementById('village-modal');
            const title = document.getElementById('village-modal-title');
            const form = document.getElementById('village-form');
            
            if (village) {
                title.textContent = 'ແກ້ໄຂບ້ານ';
                document.getElementById('village-id').value = village.vill_id;
                document.getElementById('village-name').value = village.vill_name;
                document.getElementById('village-name-en').value = village.vill_name_en || '';
                
                const district = districts.find(d => d.di_id == village.di_id);
                if (district) {
                    document.getElementById('village-province').value = district.pr_id;
                    updateVillageDistrictFilter(district.pr_id);
                    document.getElementById('village-district').value = village.di_id;
                }
                
                form.setAttribute('data-id', village.id);
            } else {
                title.textContent = 'ເພີ່ມບ້ານ';
                form.reset();
                form.removeAttribute('data-id');
                // Generate auto ID for new village
                generateAutoVillageId();
            }
            
            modal.style.display = 'flex';
        }

        function generateAutoProvinceId() {
            if (provinces.length === 0) {
                document.getElementById('province-id').value = 1;
                return;
            }
            
            // Find the highest province ID and add 1
            const maxId = Math.max(...provinces.map(p => p.pr_id));
            document.getElementById('province-id').value = maxId + 1;
        }

        function generateAutoDistrictId() {
            if (districts.length === 0) {
                document.getElementById('district-id').value = 1;
                return;
            }
            
            // Find the highest district ID and add 1
            const maxId = Math.max(...districts.map(d => d.di_id));
            document.getElementById('district-id').value = maxId + 1;
        }

        function generateAutoVillageId() {
            if (villages.length === 0) {
                document.getElementById('village-id').value = 1;
                return;
            }
            
            // Find the highest village ID and add 1
            const maxId = Math.max(...villages.map(v => v.vill_id));
            document.getElementById('village-id').value = maxId + 1;
        }

        function saveProvince() {
            const form = document.getElementById('province-form');
            const provinceId = form.getAttribute('data-id');
            const data = {
                pr_id: parseInt(document.getElementById('province-id').value),
                pr_name: document.getElementById('province-name').value,
                pr_name_en: document.getElementById('province-name-en').value || null
            };
            
            if (provinceId) {
                // Update existing province
                db.collection('provinces').doc(provinceId).update(data)
                    .then(() => {
                        loadProvinces();
                        document.getElementById('province-modal').style.display = 'none';
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການອັບເດດແຂວງ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການອັບເດດແຂວງ: ' + error.message);
                    });
            } else {
                // Add new province
                db.collection('provinces').add(data)
                    .then(() => {
                        loadProvinces();
                        document.getElementById('province-modal').style.display = 'none';
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການເພີ່ມແຂວງ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການເພີ່ມແຂວງ: ' + error.message);
                    });
            }
        }

        function saveDistrict() {
            const form = document.getElementById('district-form');
            const districtId = form.getAttribute('data-id');
            const data = {
                di_id: parseInt(document.getElementById('district-id').value),
                di_name: document.getElementById('district-name').value,
                di_name_en: document.getElementById('district-name-en').value || null,
                pr_id: parseInt(document.getElementById('district-province').value)
            };
            
            if (districtId) {
                // Update existing district
                db.collection('districts').doc(districtId).update(data)
                    .then(() => {
                        loadDistricts();
                        document.getElementById('district-modal').style.display = 'none';
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການອັບເດດເມືອງ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການອັບເດດເມືອງ: ' + error.message);
                    });
            } else {
                // Add new district
                db.collection('districts').add(data)
                    .then(() => {
                        loadDistricts();
                        document.getElementById('district-modal').style.display = 'none';
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການເພີ່ມເມືອງ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການເພີ່ມເມືອງ: ' + error.message);
                    });
            }
        }

        function saveVillage() {
            const form = document.getElementById('village-form');
            const villageId = form.getAttribute('data-id');
            const data = {
                vill_id: parseInt(document.getElementById('village-id').value),
                vill_name: document.getElementById('village-name').value,
                vill_name_en: document.getElementById('village-name-en').value || null,
                di_id: parseInt(document.getElementById('village-district').value)
            };
            
            if (villageId) {
                // Update existing village
                db.collection('villages').doc(villageId).update(data)
                    .then(() => {
                        loadVillages();
                        document.getElementById('village-modal').style.display = 'none';
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການອັບເດດບ້ານ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການອັບເດດບ້ານ: ' + error.message);
                    });
            } else {
                // Add new village
                db.collection('villages').add(data)
                    .then(() => {
                        loadVillages();
                        document.getElementById('village-modal').style.display = 'none';
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການເພີ່ມບ້ານ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການເພີ່ມບ້ານ: ' + error.message);
                    });
            }
        }

        function editProvince(provinceId) {
            const province = provinces.find(p => p.id === provinceId);
            if (province) {
                showProvinceModal(province);
            }
        }

        function editDistrict(districtId) {
            const district = districts.find(d => d.id === districtId);
            if (district) {
                showDistrictModal(district);
            }
        }

        function editVillage(villageId) {
            const village = villages.find(v => v.id === villageId);
            if (village) {
                showVillageModal(village);
            }
        }

        function deleteProvince(provinceId) {
            if (confirm('ເຈົ້າແນ່ໃຈບໍ່ທີ່ຈະລົບແຂວງນີ້ອອກ? ມັນຈະລົບເມືອງ ແລະ ບ້ານທັງໝົດທີ່ຢູ່ໃນແຂວງນີ້.')) {
                db.collection('provinces').doc(provinceId).delete()
                    .then(() => {
                        loadProvinces();
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການລົບແຂວງ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການລົບແຂວງ: ' + error.message);
                    });
            }
        }

        function deleteDistrict(districtId) {
            if (confirm('ເຈົ້າແນ່ໃຈບໍ່ທີ່ຈະລົບເມືອງນີ້ອອກ? ມັນຈະລົບບ້ານທັງໝົດທີ່ຢູ່ໃນເມືອງນີ້.')) {
                db.collection('districts').doc(districtId).delete()
                    .then(() => {
                        loadDistricts();
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການລົບເມືອງ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການລົບເມືອງ: ' + error.message);
                    });
            }
        }

        function deleteVillage(villageId) {
            if (confirm('ເຈົ້າແນ່ໃຈບໍທີ່ຈະລົບບ້ານນີ້ອອກ?')) {
                db.collection('villages').doc(villageId).delete()
                    .then(() => {
                        loadVillages();
                    })
                    .catch(error => {
                        console.error('ຂໍ້ຜິດພາດໃນການລົບບ້ານ:', error);
                        alert('ຂໍ້ຜິດພາດໃນການລົບບ້ານ: ' + error.message);
                    });
            }
        }

        function navigatePage(direction, type) {
            let currentPageElement, totalPagesElement, displayFunction;
            
            switch(type) {
                case 'province':
                    currentPageElement = document.getElementById('current-page-province');
                    totalPagesElement = document.getElementById('total-pages-province');
                    displayFunction = displayProvinces;
                    break;
                case 'district':
                    currentPageElement = document.getElementById('current-page-district');
                    totalPagesElement = document.getElementById('total-pages-district');
                    displayFunction = displayDistricts;
                    break;
                case 'village-admin':
                    currentPageElement = document.getElementById('current-page-village');
                    totalPagesElement = document.getElementById('total-pages-village');
                    displayFunction = displayVillagesAdmin;
                    break;
                default: // 'village'
                    currentPageElement = document.getElementById('current-page');
                    totalPagesElement = document.getElementById('total-pages');
                    displayFunction = displayVillages;
                    break;
            }
            
            let currentPageNum = parseInt(currentPageElement.textContent);
            const totalPages = parseInt(totalPagesElement.textContent);
            
            if (direction === 'prev' && currentPageNum > 1) {
                currentPageNum--;
            } else if (direction === 'next' && currentPageNum < totalPages) {
                currentPageNum++;
            }
            
            currentPageElement.textContent = currentPageNum;
            displayFunction();
        }
    </script>
</body>
</html>
